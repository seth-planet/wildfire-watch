[tool:pytest]
# Pytest configuration for Wildfire Watch test suite
# Handles long timeouts for MQTT broker setup and integration tests

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Timeout settings - accommodate slow MQTT broker and infrastructure setup
timeout = 3600
timeout_method = thread
timeout_func_only = true
timeout_disable_debugger_detection = true
session_timeout = 7200

# Output configuration
addopts = 
    -v
    --tb=short
    --strict-markers
    --strict-config
    --color=yes
    --durations=10
    --timeout-disable-debugger-detection
    -W ignore::DeprecationWarning:paho.mqtt
    -W ignore::DeprecationWarning:onvif
    -W ignore::UserWarning:cv2
    --setup-show
    --setup-plan

# Logging configuration
log_level = INFO
log_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_date_format = %Y-%m-%d %H:%M:%S
log_auto_indent = true

# Test markers - define expected test categories
markers =
    slow: marks tests as slow (may take >30 seconds)
    integration: marks tests as integration tests (require external services)
    hardware: marks tests requiring hardware (Raspberry Pi, Coral TPU, etc.)
    network: marks tests requiring network access
    mqtt: marks tests requiring MQTT broker
    docker: marks tests requiring Docker
    coral: marks tests requiring Coral TPU hardware
    gpu: marks tests requiring GPU hardware
    api_usage: marks tests for API usage validation
    yolo_nas: marks tests for YOLO-NAS training/inference
    qat_functionality: marks tests for quantization-aware training
    int8_quantization: marks tests for INT8 model quantization
    frigate_integration: marks tests for Frigate NVR integration
    model_converter: marks tests for model format conversion
    deployment: marks tests for production deployment
    security_nvr: marks tests for security NVR functionality
    timeout_expected: marks tests that are expected to have long timeouts
    infrastructure_dependent: marks tests that depend on slow infrastructure

# Minimum version
minversion = 6.0

# Required plugins
required_plugins = 
    pytest-timeout
    pytest-mock

# Filter warnings to reduce noise while preserving important ones
filterwarnings =
    ignore::DeprecationWarning:paho.mqtt.*
    ignore::DeprecationWarning:onvif.*
    ignore::UserWarning:cv2.*
    ignore::PendingDeprecationWarning:torch.*
    default::DeprecationWarning:camera_detector.*
    default::DeprecationWarning:fire_consensus.*
    default::DeprecationWarning:gpio_trigger.*
    default::UserWarning:tests.*
    ignore:.*unclosed.*:ResourceWarning
    ignore:.*coroutine.*was never awaited:RuntimeWarning